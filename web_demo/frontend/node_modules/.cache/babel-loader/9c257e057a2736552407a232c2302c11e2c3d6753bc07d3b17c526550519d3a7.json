{"ast":null,"code":"import { InboxOutlined, DeleteOutlined, ThunderboltOutlined, PictureOutlined } from '@ant-design/icons-vue';\nimport axios from 'axios';\nexport default {\n  name: 'SinglePredict',\n  components: {\n    InboxOutlined,\n    DeleteOutlined,\n    ThunderboltOutlined,\n    PictureOutlined\n  },\n  data() {\n    return {\n      models: [],\n      selectedModel: null,\n      fileList: [],\n      imageUrl: null,\n      imageData: null,\n      predicting: false,\n      result: null\n    };\n  },\n  computed: {\n    currentModelInfo() {\n      return this.models.find(m => m.id === this.selectedModel);\n    }\n  },\n  mounted() {\n    this.loadModels();\n    // Check if model is pre-selected from route query\n    if (this.$route.query.model) {\n      this.selectedModel = this.$route.query.model;\n    }\n  },\n  methods: {\n    async loadModels() {\n      try {\n        const response = await axios.get('/api/models');\n        this.models = response.data.models;\n\n        // Auto-select first model if none selected\n        if (!this.selectedModel && this.models.length > 0) {\n          this.selectedModel = this.models[0].id;\n        }\n      } catch (error) {\n        this.$message.error('加载模型失败: ' + error.message);\n      }\n    },\n    onModelChange() {\n      this.result = null;\n    },\n    beforeUpload(file) {\n      const isImage = file.type.startsWith('image/');\n      if (!isImage) {\n        this.$message.error('只能上传图片文件!');\n        return false;\n      }\n      const isLt10M = file.size / 1024 / 1024 < 10;\n      if (!isLt10M) {\n        this.$message.error('图片大小不能超过 10MB!');\n        return false;\n      }\n      return false; // Prevent auto upload\n    },\n    handleUpload(info) {\n      const file = info.file;\n      if (file.status !== 'removed') {\n        this.getBase64(file.originFileObj || file, imageUrl => {\n          this.imageUrl = imageUrl;\n          this.imageData = imageUrl;\n          this.result = null;\n        });\n      }\n    },\n    getBase64(file, callback) {\n      const reader = new FileReader();\n      reader.addEventListener('load', () => callback(reader.result));\n      reader.readAsDataURL(file);\n    },\n    clearImage() {\n      this.imageUrl = null;\n      this.imageData = null;\n      this.fileList = [];\n      this.result = null;\n    },\n    async predict() {\n      if (!this.imageData || !this.selectedModel) {\n        this.$message.warning('请上传图片并选择模型');\n        return;\n      }\n      this.predicting = true;\n      try {\n        const response = await axios.post('/api/predict', {\n          model_id: this.selectedModel,\n          image: this.imageData\n        });\n        this.result = response.data;\n        this.$message.success('识别完成!');\n      } catch (error) {\n        this.$message.error('识别失败: ' + (error.response?.data?.error || error.message));\n      } finally {\n        this.predicting = false;\n      }\n    }\n  }\n};","map":{"version":3,"names":["InboxOutlined","DeleteOutlined","ThunderboltOutlined","PictureOutlined","axios","name","components","data","models","selectedModel","fileList","imageUrl","imageData","predicting","result","computed","currentModelInfo","find","m","id","mounted","loadModels","$route","query","model","methods","response","get","length","error","$message","message","onModelChange","beforeUpload","file","isImage","type","startsWith","isLt10M","size","handleUpload","info","status","getBase64","originFileObj","callback","reader","FileReader","addEventListener","readAsDataURL","clearImage","predict","warning","post","model_id","image","success"],"sources":["C:\\Users\\oscar\\Downloads\\swatchon2\\web_demo\\frontend\\src\\views\\SinglePredict.vue"],"sourcesContent":["<template>\n  <div>\n    <a-page-header\n      title=\"单图识别\"\n      sub-title=\"上传单张面料图片进行智能分类识别\"\n      @back=\"$router.go(-1)\"\n    />\n\n    <a-row :gutter=\"32\">\n      <a-col :xs=\"24\" :lg=\"12\">\n        <a-card title=\"选择模型\" style=\"margin-bottom: 24px;\">\n          <a-select\n            v-model:value=\"selectedModel\"\n            placeholder=\"请选择识别模型\"\n            style=\"width: 100%\"\n            @change=\"onModelChange\"\n          >\n            <a-select-option v-for=\"model in models\" :key=\"model.id\" :value=\"model.id\">\n              <a-space>\n                <a-tag :color=\"model.type === 'binary' ? 'blue' : 'green'\" size=\"small\">\n                  {{ model.type === 'binary' ? '二分类' : '多分类' }}\n                </a-tag>\n                {{ model.name }}\n              </a-space>\n            </a-select-option>\n          </a-select>\n          <p v-if=\"currentModelInfo\" style=\"margin-top: 8px; color: #666; font-size: 14px;\">\n            {{ currentModelInfo.description }}\n          </p>\n        </a-card>\n\n        <a-card title=\"上传图片\">\n          <a-upload-dragger\n            v-model:fileList=\"fileList\"\n            :before-upload=\"beforeUpload\"\n            :show-upload-list=\"false\"\n            accept=\"image/*\"\n            @change=\"handleUpload\"\n          >\n            <div v-if=\"!imageUrl\" style=\"padding: 40px;\">\n              <p class=\"ant-upload-drag-icon\">\n                <inbox-outlined style=\"font-size: 48px; color: #1890ff;\" />\n              </p>\n              <p class=\"ant-upload-text\">点击或拖拽图片到此区域上传</p>\n              <p class=\"ant-upload-hint\">支持 JPG、PNG、BMP、WEBP 格式</p>\n            </div>\n            <div v-else style=\"position: relative;\">\n              <img :src=\"imageUrl\" style=\"max-width: 100%; max-height: 300px; object-fit: contain;\" />\n              <a-button\n                type=\"primary\"\n                danger\n                size=\"small\"\n                style=\"position: absolute; top: 8px; right: 8px;\"\n                @click.stop=\"clearImage\"\n              >\n                <template #icon>\n                  <delete-outlined />\n                </template>\n              </a-button>\n            </div>\n          </a-upload-dragger>\n\n          <div style=\"margin-top: 16px; text-align: center;\">\n            <a-button\n              type=\"primary\"\n              size=\"large\"\n              :loading=\"predicting\"\n              :disabled=\"!imageUrl || !selectedModel\"\n              @click=\"predict\"\n            >\n              <template #icon>\n                <thunderbolt-outlined />\n              </template>\n              开始识别\n            </a-button>\n          </div>\n        </a-card>\n      </a-col>\n\n      <a-col :xs=\"24\" :lg=\"12\">\n        <a-card title=\"识别结果\">\n          <div v-if=\"!result && !predicting\" style=\"text-align: center; padding: 60px 20px; color: #999;\">\n            <picture-outlined style=\"font-size: 64px; margin-bottom: 16px;\" />\n            <p>请上传图片并选择模型进行识别</p>\n          </div>\n\n          <a-spin :spinning=\"predicting\" style=\"width: 100%;\">\n            <div v-if=\"result\">\n              <a-alert\n                :type=\"result.predictions[0].confidence > 0.8 ? 'success' : result.predictions[0].confidence > 0.6 ? 'warning' : 'info'\"\n                :message=\"`识别结果: ${result.predictions[0].class}`\"\n                :description=\"`置信度: ${(result.predictions[0].confidence * 100).toFixed(1)}%`\"\n                show-icon\n                style=\"margin-bottom: 24px;\"\n              />\n\n              <h4 style=\"margin-bottom: 16px;\">详细预测结果</h4>\n              <a-list\n                :data-source=\"result.predictions\"\n                size=\"small\"\n              >\n                <template #renderItem=\"{ item, index }\">\n                  <a-list-item>\n                    <a-list-item-meta>\n                      <template #title>\n                        <a-space>\n                          <a-tag :color=\"index === 0 ? 'blue' : 'default'\">\n                            #{{ item.rank }}\n                          </a-tag>\n                          {{ item.class }}\n                        </a-space>\n                      </template>\n                      <template #description>\n                        <a-progress\n                          :percent=\"item.confidence * 100\"\n                          :stroke-color=\"index === 0 ? '#1890ff' : '#d9d9d9'\"\n                          size=\"small\"\n                        />\n                      </template>\n                    </a-list-item-meta>\n                  </a-list-item>\n                </template>\n              </a-list>\n\n              <a-divider />\n              \n              <a-descriptions title=\"识别信息\" size=\"small\" :column=\"1\">\n                <a-descriptions-item label=\"使用模型\">{{ result.model.name }}</a-descriptions-item>\n                <a-descriptions-item label=\"模型类型\">{{ result.model.type === 'binary' ? '二分类' : '多分类' }}</a-descriptions-item>\n                <a-descriptions-item label=\"识别时间\">{{ new Date(result.timestamp * 1000).toLocaleString() }}</a-descriptions-item>\n              </a-descriptions>\n            </div>\n          </a-spin>\n        </a-card>\n      </a-col>\n    </a-row>\n  </div>\n</template>\n\n<script>\nimport { InboxOutlined, DeleteOutlined, ThunderboltOutlined, PictureOutlined } from '@ant-design/icons-vue'\nimport axios from 'axios'\n\nexport default {\n  name: 'SinglePredict',\n  components: {\n    InboxOutlined,\n    DeleteOutlined,\n    ThunderboltOutlined,\n    PictureOutlined\n  },\n  data() {\n    return {\n      models: [],\n      selectedModel: null,\n      fileList: [],\n      imageUrl: null,\n      imageData: null,\n      predicting: false,\n      result: null\n    }\n  },\n  computed: {\n    currentModelInfo() {\n      return this.models.find(m => m.id === this.selectedModel)\n    }\n  },\n  mounted() {\n    this.loadModels()\n    // Check if model is pre-selected from route query\n    if (this.$route.query.model) {\n      this.selectedModel = this.$route.query.model\n    }\n  },\n  methods: {\n    async loadModels() {\n      try {\n        const response = await axios.get('/api/models')\n        this.models = response.data.models\n        \n        // Auto-select first model if none selected\n        if (!this.selectedModel && this.models.length > 0) {\n          this.selectedModel = this.models[0].id\n        }\n      } catch (error) {\n        this.$message.error('加载模型失败: ' + error.message)\n      }\n    },\n    \n    onModelChange() {\n      this.result = null\n    },\n    \n    beforeUpload(file) {\n      const isImage = file.type.startsWith('image/')\n      if (!isImage) {\n        this.$message.error('只能上传图片文件!')\n        return false\n      }\n      \n      const isLt10M = file.size / 1024 / 1024 < 10\n      if (!isLt10M) {\n        this.$message.error('图片大小不能超过 10MB!')\n        return false\n      }\n      \n      return false // Prevent auto upload\n    },\n    \n    handleUpload(info) {\n      const file = info.file\n      if (file.status !== 'removed') {\n        this.getBase64(file.originFileObj || file, (imageUrl) => {\n          this.imageUrl = imageUrl\n          this.imageData = imageUrl\n          this.result = null\n        })\n      }\n    },\n    \n    getBase64(file, callback) {\n      const reader = new FileReader()\n      reader.addEventListener('load', () => callback(reader.result))\n      reader.readAsDataURL(file)\n    },\n    \n    clearImage() {\n      this.imageUrl = null\n      this.imageData = null\n      this.fileList = []\n      this.result = null\n    },\n    \n    async predict() {\n      if (!this.imageData || !this.selectedModel) {\n        this.$message.warning('请上传图片并选择模型')\n        return\n      }\n      \n      this.predicting = true\n      try {\n        const response = await axios.post('/api/predict', {\n          model_id: this.selectedModel,\n          image: this.imageData\n        })\n        \n        this.result = response.data\n        this.$message.success('识别完成!')\n      } catch (error) {\n        this.$message.error('识别失败: ' + (error.response?.data?.error || error.message))\n      } finally {\n        this.predicting = false\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.ant-upload-dragger {\n  background: #fafafa !important;\n}\n\n.ant-upload-dragger:hover {\n  border-color: #1890ff !important;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}